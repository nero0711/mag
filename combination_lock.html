<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Крутилки — по очереди</title>
  <style>
    :root{
      --box-w: 350px;
      --box-h: 400px;
      --knob-size: 70px;
      --gap: 20px;
      --accent: #4f46e5;
    }
    body{
      margin:0;display:grid;place-items:center;height:100vh;
      /*background:#0a0f1f;font-family: system-ui, sans-serif; color:#e5e7eb;*/
      margin: 0;
      /*height: 100vh;*/
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #d0f0e2;
      font-family: 'Arial', sans-serif;
      user-select: none;
    }
    .container {
      width: 320px;
      height: 330px;
      background-color:  #94A7A3;
      border: 2px solid #777777;
      border-radius: 50px;
      box-shadow:
        inset 2px 2px 0px 2px #A6BCB7,
        3px 20px 0px #5B7A78,
        9px 10px 0px #5B7A78,
        0px 40px 0px #255853,
        9px 40px 0px #255853;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
      color: white;
    }
    header{display:flex; justify-content:space-between; align-items:center}
    .title{
        font-size: 12px;
        font-weight: 700;
        margin: 20px 0px 10px 0px;
        justify-content: center;
        display: flex;
        color: #d0d0d0;
        z-index: 20;
        width: 100%;
        top: -15px;
        left: 75px;
        position: absolute;}
    .timer{
        font-variant-numeric: tabular-nums;
        font-weight:700;
        width:60px; height:30px; border-radius:6px; background: #3a404d;
        display:flex; align-items:center; justify-content:center;
        font-weight:800;
        box-shadow: inset 2px 2px 0px 1px #5E7A77,
                  /*inset 4px 4px 0px 2px #d0cfcf,*/
                  2px 2px 0px #A8BCBA;
    }

    .dials{display:grid; grid-template-columns: repeat(3,1fr); gap:var(--gap); color: #d0f0e2;place-items:center; margin-top:8px}
    .dial{display:flex; flex-direction:column; align-items:center; gap:6px;}
    .display{
      width:42px; height:28px; border-radius:6px; background: #3a404d;
      display:flex; align-items:center; justify-content:center;
      font-weight:800; font-size:16px;
      box-shadow: inset 2px 2px 0px 1px #5E7A77,
                  /*inset 3px 3px 0px 2px #d0cfcf,*/
                  1px 1px 0px #A8BCBA;
    }
    .knob{
      width:var(--knob-size); height:var(--knob-size);
      border-radius:50%;
      background-color:#94A7A3;
      position:relative; cursor:grab; touch-action:none;
      box-shadow: inset 2px 2px 0px 2px #A6BCB7,
                  5px 0px 0px #5B7A78,
                  0px 5px 0px #5B7A78,
                  5px 5px 0px #5B7A78;
                  /*0px 5px 0px #255853,*/
                  /*9px 5px 0px #255853;*/
      transition: opacity .3s;
      border-style: dashed;
      border-color: #A6BCB7;
    }
    .knob:active{cursor:grabbing;}
    .pointer{
      position:absolute; top:8px; left:50%; width:4px; height:20px;
      background:#259C69;
      border-radius:2px;
      transform:translateX(-50%);
    }
    .knob.ok{
        box-shadow: 0 0 0 2px #255853,
                    inset -4px -4px 0px rgba(255,255,255,.05),
                    inset 4px 4px 0px #5B7A78;
    }
    .knob.locked{ opacity:0.4; pointer-events:none; cursor:not-allowed; }

    .win-overlay{ position:absolute; inset:0; display:none; place-items:center; background-color:  #94A7A3;}
    .win-overlay.show{ display:grid; }
    .prize{ width:270px; height:270px; border-radius:16px; object-fit:cover; }
  </style>
</head>
<body>
    <div class="container" id="game">
      <header>
        <div class="title" id="module">Module05092</div>
        <div class="timer" id="timer">05:00</div>
      </header>

      <div class="dials" id="dials"></div>

      <div class="win-overlay" id="win">
        <div>
          <img class="prize" id="prize" alt="Приз" src="img0.png" />
        </div>
      </div>
    </div>
</body>
<script>
(function(){
  const DIALS = 6;
  const TOTAL_SECONDS = 5*60;

  const state = {
    secret: [],
    values: [],
    angles: [],
    dragging: null,
    secondsLeft: TOTAL_SECONDS,
    locked: false,
    currentIndex: 0 // какая ручка сейчас активна
  };

  const el = {
    dials: document.getElementById('dials'),
    timer: document.getElementById('timer'),
    win: document.getElementById('win'),
    prize: document.getElementById('prize')
  };

  function pad(n){ return (n<10?'0':'')+n }
  function updateTimer(){
    const m = Math.floor(state.secondsLeft/60), s = state.secondsLeft%60;
    el.timer.textContent = pad(m)+":"+pad(s);
    if (state.secondsLeft === 0) location.reload();
  }

  function randDigit(){ return Math.floor(Math.random()*10) }
  function norm360(a){ return ((a%360)+360)%360 }
  function angDiff(a,b){ let d = a-b; d = ((d+180)%360)-180; return d; }
  function angleToDigit(angle){ return Math.round(norm360(angle)/36)%10 }

  function updateDialUI(i){
    const wrap = el.dials.children[i];
    wrap.querySelector('.knob').style.transform = `rotate(${state.angles[i]}deg)`;
    wrap.querySelector('.display').textContent = state.values[i];
  }

  function setAngle(i, angle){
    state.angles[i] = angle;
    state.values[i] = angleToDigit(angle);
    updateDialUI(i);
  }

  function lockKnob(i){
    el.dials.children[i].querySelector('.knob').classList.add("locked");
  }
  function unlockKnob(i){
    el.dials.children[i].querySelector('.knob').classList.remove("locked");
  }

  function createDial(i){
    const wrap = document.createElement('div'); wrap.className='dial';
    const disp = document.createElement('div'); disp.className='display'; disp.textContent='0';
    const knob = document.createElement('div'); knob.className='knob'; knob.dataset.index=i;
    const ptr = document.createElement('div'); ptr.className='pointer'; knob.appendChild(ptr);
    wrap.appendChild(disp); wrap.appendChild(knob);

    knob.addEventListener('pointerdown', (e)=>{
      if (state.locked || i!==state.currentIndex) return;
      e.preventDefault(); knob.setPointerCapture(e.pointerId);
      const r = knob.getBoundingClientRect();
      const cx = r.left + r.width/2, cy = r.top + r.height/2;
      const downAngle = Math.atan2(e.clientY - cy, e.clientX - cx) * 180/Math.PI;
      state.dragging = { i, startAngle: state.angles[i], downAngle };
    });

    knob.addEventListener('pointermove', (e)=>{
      const g = state.dragging; if (!g || g.i!==i || state.locked) return;
      const r = knob.getBoundingClientRect();
      const cx = r.left + r.width/2, cy = r.top + r.height/2;
      const cur = Math.atan2(e.clientY - cy, e.clientX - cx) * 180/Math.PI;
      const delta = angDiff(cur, g.downAngle);
      setAngle(i, g.startAngle + delta);
    });

    knob.addEventListener('pointerup', ()=>{
      if (state.locked || i!==state.currentIndex) return;
      validateDial(i);
      state.dragging = null;
    });

    return wrap;
  }

  function validateDial(i){
    if (state.values[i] === state.secret[i]){
      el.dials.children[i].querySelector('.knob').classList.add('ok');
      if (i+1 < DIALS){
        unlockKnob(i+1);
        state.currentIndex = i+1;
      } else {
        checkWin();
      }
    } else {
      resetAll();
    }
  }

  function resetAll(){
    for (let i=0;i<DIALS;i++){
      state.values[i]=0; state.angles[i]=0;
      const knob = el.dials.children[i].querySelector('.knob');
      knob.style.transform='rotate(0deg)';
      el.dials.children[i].querySelector('.display').textContent='0';
      knob.classList.remove('ok');
      lockKnob(i);
    }
    state.currentIndex = 0;
    unlockKnob(0);
  }

  function checkWin(){
    if (state.values.every((v,i)=> v===state.secret[i])){
      state.locked = true;
      el.win.classList.add('show');
    }
  }

  function init(){
    state.secret = Array.from({length:DIALS}, randDigit);
    state.values = Array.from({length:DIALS}, ()=>0);
    state.angles = Array.from({length:DIALS}, ()=>0);

    el.dials.innerHTML='';
    for (let i=0;i<DIALS;i++){
      el.dials.appendChild(createDial(i));
      updateDialUI(i);
      lockKnob(i);
    }
    unlockKnob(0);

    state.secondsLeft = TOTAL_SECONDS; updateTimer();
    setInterval(()=>{ if(!state.locked){ state.secondsLeft=Math.max(0,state.secondsLeft-1); updateTimer(); } }, 1000);

    let clickCount = 0;
    el.timer.addEventListener("click", ()=>{
      clickCount++;
      if (clickCount >= 3){
        if (!document.getElementById("secret-code")){
            let module = document.getElementById('module')
            module.innerText = 'Module' + state.secret.join("")
        }
      }
      setTimeout(()=>{ clickCount = 0 }, 1500);
    });
  }
  init();
})();
</script>

</html>
